<img src="zkrates_orig_mr_peace.jpg"  id="pixelitimg" alt="">
<canvas id="pixelitcanvas"></canvas>
<script src="pixelit.js"></script>

<h3>API</h3>
<p>You can chain all methods together, beware that the order they are applied can change the final result.</p> 
<p>Applying first the color palette and then the greyscale can give a slightlity different image.</p>

<p class="api"><strong>.draw()</strong> draw to canvas from image source and resizes if max height or max width is reached</p>
<p class="api"><strong>.hideFromImg()</strong> hides the from image element, is applied on object creation</p>
<p class="api"><strong>.setDrawFrom(elem)</strong> elem to get the image to pixelate</p>
<p class="api"><strong>.setDrawTo(elem)</strong> canvas elem to draw the image</p>
<p class="api"><strong>.setFromImgSource(src)</strong> change the src from the image element</p>
<p class="api"><strong>.setpalette(arr)</strong> sets the color palette to use, takes an array of rgb colors: [[int,int,int]], int from 0 to 255</p>
<p class="api"><strong>.setMaxWidth(int)</strong> set canvas image maximum width, it can resize the output image, only used when .resizeImage() is applied</p>
<p class="api"><strong>.setMaxHeight(int)</strong> set canvas image maximum height, it can resize the output image, max height overrides max width, only used when .resizeImage() is applied</p>
<p class="api"><strong>.setScale(int)</strong> set pixelate scale [0...50]</p>
<p class="api"><strong>.getpalette()</strong> returns array of current palette, can't be chained</p>
<p class="api"><strong>.convertGrayscale()</strong> converts image to greyscale, apply only after .draw is called</p>
<p class="api"><strong>.convertpalette()</strong> converts image with the defined color palette, apply only after .draw is called</p>
<p class="api"><strong>.resizeImage()</strong> resizes the output image if bigger than the defined max Height or max Width</p>
<p class="api"><strong>.pixelate()</strong> draws a pixelated version of the from image to the to canvas, , apply only after .draw is called</p>
<p class="api"><strong>.saveImage()</strong> saves/downloads current image</p>

<script charset="utf-8">

function randomIntFromInterval(min, max) { // min and max included 
  return Math.floor(Math.random() * (max - min + 1) + min)
}

function download(content, fileName, contentType) {
    var a = document.createElement("a");
    var file = new Blob([content], {type: contentType});
    a.href = URL.createObjectURL(file);
    a.download = fileName;
    a.click();
}

const paletteList = [
  [
    [7, 5, 5],
    [33, 25, 25],
    [82, 58, 42],
    [138, 107, 62],
    [193, 156, 77],
    [234, 219, 116],
    [160, 179, 53],
    [83, 124, 68],
    [66, 60, 86],
    [89, 111, 175],
    [107, 185, 182],
    [251, 250, 249],
    [184, 170, 176],
    [121, 112, 126],
    [148, 91, 40],
  ],
  [
    [13, 43, 69],
    [32, 60, 86],
    [84, 78, 104],
    [141, 105, 122],
    [208, 129, 89],
    [255, 170, 94],
    [255, 212, 163],
    [255, 236, 214],
  ],
  [
    [43, 15, 84],
    [171, 31, 101],
    [255, 79, 105],
    [255, 247, 248],
    [255, 129, 66],
    [255, 218, 69],
    [51, 104, 220],
    [73, 231, 236],
  ],
  [
    [48, 0, 48],
    [96, 40, 120],
    [248, 144, 32],
    [248, 240, 136],
  ],
  [
    [239, 26, 26],
    [172, 23, 23],
    [243, 216, 216],
    [177, 139, 139],
    [53, 52, 65],
    [27, 26, 29],
  ],
  [
    [26, 28, 44],
    [93, 39, 93],
    [177, 62, 83],
    [239, 125, 87],
    [255, 205, 117],
    [167, 240, 112],
    [56, 183, 100],
    [37, 113, 121],
    [41, 54, 111],
    [59, 93, 201],
    [65, 166, 246],
    [115, 239, 247],
    [244, 244, 244],
    [148, 176, 194],
    [86, 108, 134],
    [51, 60, 87],
  ],
  [
    [44, 33, 55],
    [118, 68, 98],
    [237, 180, 161],
    [169, 104, 104],
  ],

  [
    [171, 97, 135],
    [235, 198, 134],
    [216, 232, 230],
    [101, 219, 115],
    [112, 157, 207],
    [90, 104, 125],
    [33, 30, 51],
  ],
  [
    [140, 143, 174],
    [88, 69, 99],
    [62, 33, 55],
    [154, 99, 72],
    [215, 155, 125],
    [245, 237, 186],
    [192, 199, 65],
    [100, 125, 52],
    [228, 148, 58],
    [157, 48, 59],
    [210, 100, 113],
    [112, 55, 127],
    [126, 196, 193],
    [52, 133, 157],
    [23, 67, 75],
    [31, 14, 28],
  ],
  [
    [94, 96, 110],
    [34, 52, 209],
    [12, 126, 69],
    [68, 170, 204],
    [138, 54, 34],
    [235, 138, 96],
    [0, 0, 0],
    [92, 46, 120],
    [226, 61, 105],
    [170, 92, 61],
    [255, 217, 63],
    [181, 181, 181],
    [255, 255, 255],
  ],
  [
    [49, 31, 95],
    [22, 135, 167],
    [31, 213, 188],
    [237, 255, 177],
  ],
  [
    [21, 25, 26],
    [138, 76, 88],
    [217, 98, 117],
    [230, 184, 193],
    [69, 107, 115],
    [75, 151, 166],
    [165, 189, 194],
    [255, 245, 247],
  ],
];


// ---------------------------------------------------------
// todo
// send file to IPFS + get CID back
// create json with rndInt_* values + CID from png
// send json to IPFS + get CID back
// mint NFT 
// ---------------------------------------------------------



// create random integer values for the parameters
var rndInt_file = randomIntFromInterval(1, 6)  
var rndInt_palette = randomIntFromInterval(0, 11)
var rndInt_scale = randomIntFromInterval(2, 50)
var rndInt_grey = randomIntFromInterval(1, 20)  // 5% probability for greyscale
var rndInt_maxWidth = randomIntFromInterval(350, 450)  

 console.log(rndInt_file);
 console.log(rndInt_palette);
 console.log(rndInt_scale);
 console.log(rndInt_grey);
 console.log(rndInt_maxWidth);

// set fixed values
// rndInt_palette = 10
// rndInt_scale = 38
// rndInt_maxWidth = 438
// rndInt_grey = 2


 //const file_name = "zkrates_xxx_".concat(rndInt_palette, "_", rndInt_scale, "_", rndInt_maxWidth, "_", rndInt_file, "_", rndInt_grey==1 ? 1: 0, "_x.png");
 const file_name = "zkrates_xxx_".concat(rndInt_palette, "_", rndInt_scale, "_", rndInt_maxWidth, "_rm_", rndInt_grey==1 ? 1: 0, "_x.png");
 console.log(file_name);

const config = {
      //to : elem,
      //defaults to document.getElementById("pixelitcanvas")
      //from : document.getElementById("pixelitimg"),
      //defaults to document.getElementById("pixelitimg")
      scale : rndInt_scale,
      //from 0-50, defaults to 8
      palette : paletteList[rndInt_palette], //[[44, 33, 55],[118, 68, 98],[237, 180, 161],[169, 104, 104]],
      maxWidth: rndInt_maxWidth, 
      //MaxHeight: 1000,
    }

  //create object
  const px = new pixelit(config);
  
  px.setFromImgSource("zkrates_orig_mr_peace.jpg");
  console.log(px.drawfrom.src)

  if (rndInt_grey == 1) {
    px.draw().pixelate().resizeImage().convertGrayscale().convertPalette();
  }
  else {
    px.draw().pixelate().resizeImage().convertPalette();
  }
  px.saveMyImage(file_name);

  // upload file to IPFS

  const id = 12345;
  const CID = "ipfs_CID"

  let name_z = "zkrates [zkr\u{259}ti\u{2D0}z] #";
  console.log(name_z);

  var obj = new Object();
   obj.name = name_z.concat(id);
   obj.image  = "https://ipfs.io/ipfs/".concat(CID);
   obj.description = "the first zkRollup based 10k collectibles project. minting on zkSync 1.0. #zkL222. go live 22-2-22 2:22:22 UTC";
   obj.external_url  = "www.zkrates.xyz";
   obj.attributes  = [{
        "trait_type": "#zkL222",
        "value": "middle right"
      },
      {
        "trait_type": "colour palette",
        "value": JSON.stringify(rndInt_palette)
      },
      {
        "trait_type": "block size",
        "value": JSON.stringify(rndInt_scale)
      },
      {
        "trait_type": "width",
        "value": JSON.stringify(rndInt_maxWidth)
      },
      {
        "trait_type": "greyscale",
        "value": JSON.stringify(rndInt_grey==1)
      },
      {
        "trait_type": "x",
        "value": "peace"
      }
    ]
   var jsonString= JSON.stringify(obj);
   console.log(jsonString);

   download(jsonString, 'test.json', 'text/plain');

</script>